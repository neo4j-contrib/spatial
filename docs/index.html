<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>Neo4j Spatial v5.20.1-SNAPSHOT</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Neo4j Spatial v5.20.1-SNAPSHOT</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#spatial-introduction">Introduction</a>
<ul class="sectlevel2">
<li><a href="#_get_started">Get Started</a></li>
</ul>
</li>
<li><a href="#spatial-indexing">Index and Querying</a>
<ul class="sectlevel2">
<li><a href="#spatial-loading-and-indexing">Loading and Indexing</a></li>
</ul>
</li>
<li><a href="#spatial-layers">Layers and GeometryEncoders</a></li>
<li><a href="#spatial-procedures">Neo4j Spatial Procedures</a></li>
<li><a href="#spatial-querying">Querying</a>
<ul class="sectlevel2">
<li><a href="#_jts_queries">JTS Queries</a></li>
</ul>
</li>
<li><a href="#spatial-examples">Examples</a>
<ul class="sectlevel2">
<li><a href="#spatial-import-shapefile">Importing a shapefile</a></li>
<li><a href="#spatial-import-osm">Importing an Open Street Map file</a></li>
<li><a href="#spatial-spatial-query">Executing a spatial query</a></li>
<li><a href="#spatial-export-shapefile">Export a shapefile</a></li>
<li><a href="#spatial-geopipes">GeoPipes</a></li>
<li><a href="#_geopipes_examples">GeoPipes Examples</a></li>
</ul>
</li>
<li><a href="#_appendix_integrations">Appendix: Integrations</a></li>
<li><a href="#_neo4j_spatial_in_udig">Neo4j Spatial in uDig</a>
<ul class="sectlevel2">
<li><a href="#_udig_sdk">uDig SDK</a></li>
<li><a href="#_setting_up_udig_sdk">Setting up uDig SDK</a></li>
<li><a href="#_adding_neo4j_spatial">Adding Neo4j Spatial</a></li>
<li><a href="#_testing_sample_layers_in_udig">Testing sample layers in uDig</a></li>
<li><a href="#_update_new_automatic_styles_for_osm">Update: New automatic styles for OSM</a></li>
</ul>
</li>
<li><a href="#spatial-geoserver">Neo4j Spatial Geoserver Plugin</a>
<ul class="sectlevel2">
<li><a href="#spatial-geoserver-building">Building</a></li>
<li><a href="#spatial-geoserver-deployment">Deployment into Geoserver</a></li>
<li><a href="#spatial-geoserver-trunk">Testing in GeoServer trunk</a></li>
</ul>
</li>
<li><a href="#_neo4j_spatial_in_geoserver">Neo4j Spatial in GeoServer</a>
<ul class="sectlevel2">
<li><a href="#_installing_neo4j_spatial_in_geoserver">Installing Neo4j-Spatial in GeoServer</a></li>
<li><a href="#_visualizing_neo4j_spatial_data_in_geoserver">Visualizing Neo4j Spatial data in GeoServer</a></li>
<li><a href="#_add_a_data_source">Add a data source</a></li>
<li><a href="#_publish_from_data_source">Publish from data source</a></li>
<li><a href="#_previewing_layers">Previewing layers</a></li>
<li><a href="#_controlling_layer_style">Controlling layer style</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="spatial-introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://github.com/neo4j-contrib/spatial">Neo4j Spatial</a> is a library of utilities for Neo4j that facilitate the enabling of spatial operations on data.
In particular, you can add spatial indexes to already located data, and perform spatial operations on the data like searching for data within specified regions or within a specified distance of a point of interest.
In addition, classes are provided to expose the data to GeoTools and thereby to GeoTools-enabled applications like GeoServer and uDig.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/one-street.png" alt="one street">
</div>
</div>
<div class="paragraph">
<p>The key features include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Utilities for importing from ESRI Shapefile as well as Open Street Map files</p>
</li>
<li>
<p>Support for all the common geometry types: Point, LineString, Polygon, etc.</p>
</li>
<li>
<p>An RTree index for fast searches on geometries</p>
</li>
<li>
<p>Support for topology operations during the search (contains, within, intersects, covers, disjoint, etc.)</p>
</li>
<li>
<p>The possibility to enable spatial operations on any graph of data, regardless of the way the spatial data is stored, as long as an adapter is provided to map from the graph to the geometries.</p>
</li>
<li>
<p>Ability to split a single layer or dataset into multiple sub-layers or views with pre-configured filters</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_get_started">Get Started</h3>
<div class="paragraph">
<p>The easiest way to get started with neo4j-spatial is to grab the <code>server-plugin-*.jar</code> from <a href="https://github.com/neo4j-contrib/spatial/releases">the latest release</a>, copy it to your <code>$NEO4J_HOME/plugins</code> and restart your Neo4j server.</p>
</div>
<div class="paragraph">
<p>From there you can use all the <a href="#spatial-procedures">Neo4j Spatial Procedures</a> in your Cypher queries to add Nodes to the spatial index and perform a number of spatial point, distance and intersection queries.</p>
</div>
<div class="listingblock">
<div class="title">Simple Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="cypher">CALL spatial.addPointLayer('geom');
CALL spatial.layers();

CREATE (n:Node {latitude:60.1,longitude:15.2})
WITH n
CALL spatial.addNode('geom',n) YIELD node
RETURN node;

CALL spatial.bbox('geom',{lon:15.0,lat:60.0}, {lon:15.3, lat:61.0});</code></pre>
</div>
</div>
<div class="paragraph">
<p>A good example blog post for how to use them with one of the neo4j drivers, is <a href="http://www.lyonwj.com/2016/08/09/neo4j-spatial-procedures-congressional-boundaries/">Spatial Procedures in Legis Graph</a> by <a href="http://twitter.com/lyonwj">William Lyon</a> (<a href="http://www.lyonwj.com/2016/03/21/legis-graph-spatial-indexing/">Part 1</a>).</p>
</div>
<div class="paragraph">
<p><a href="http://twitter.com/maxdemarzi">Max de Marzi</a> explains <a href="#spatial-server-plugin">[spatial-server-plugin]</a> in his <a href="https://maxdemarzi.com/2014/02/11/neo4j-spatial-part-2/">two-part blog post around restaurant recommendations</a>.</p>
</div>
<div class="paragraph">
<p>A general introduction to Neo4j Spatial and a simple example on how to use the Spatial Java APIs can be found in this <a href="https://neo4j.com/blog/neo4j-spatial-part1-finding-things-close-to-other-things/">blog post</a> by <a href="http://twitter.com/craigtaverner">Craig Taverner</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spatial-indexing">Index and Querying</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The current index is an RTree index, but it has been developed in an extensible way allowing for other indices to be added if necessary.</p>
</div>
<div class="sect2">
<h3 id="spatial-loading-and-indexing">Loading and Indexing</h3>
<div class="paragraph">
<p>It is possible to load data into the database and add it to the index during the load.
It is also possible to add existing spatial data to the index later. These are two very different scenarios, and in fact can lead to different graph structures, so we will explain them each in turn.</p>
</div>
<div class="paragraph">
<p>To load data directly into the index, the simplest approach is to start by creating a Layer that suites your data.
There are many possible choices built into Neo4j-Spatial, but two common ones
would be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SimplePointLayer - an editable layer that allows you to add only Points to the database.
This is a good choice if you only have point data and are interested primarily in proximity searches.
This layer includes utility methods specifically for that case.</p>
</li>
<li>
<p>EditableLayer(Impl) - this is the default editable layer implementation and can handle any type of simple geometry.
This includes Point, LineString and Polygon, as well as Multi-Point, Multi-LineString and Multi-Polygon.
Since it is a generic implementation and cannot know about the topology of your data model, it stores each geometry separately in a single property of a single node.
The storage format is WKB, or 'Well Known Binary', which is a binary format specific to geographic geometries, and also used by the popular open source spatial database PostGIS.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spatial-layers">Layers and GeometryEncoders</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The primary type that defines a collection of geometries is the Layer.
A layer contains an index for querying.
In addition, a Layer can be an EditableLayer if it is possible to add and modify geometries in the layer.
The next most important interface is the GeometryEncoder.</p>
</div>
<div class="paragraph">
<p>The DefaultLayer is the standard layer, making use of the WKBGeometryEncoder for storing all geometry types as byte[] properties of one node per geometry instance.</p>
</div>
<div class="paragraph">
<p>The OSMLayer is a special layer supporting Open Street Map and storing the OSM model as a single fully connected graph.
The set of Geometries provided by this layer includes Points, LineStrings and Polygons, and as such cannot be exported to Shapefile format, since that format only allows a single Geometry per layer.
However, OMSLayer extends DynamicLayer, which allow it to provide any number of sub-layers, each with a specific geometry type and in addition based on an OSM tag filter.
For example, you can have a layer providing all cycle paths as LineStrings, or a layer providing all lakes as Polygons.
Underneath these are all still backed by the same fully connected graph, but exposed dynamically as apparently separate geometry layers.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spatial-procedures">Neo4j Spatial Procedures</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Neo4j Spatial is also packaged as a ZIP file that can be unzipped into the <a href="http://neo4j.com">Neo4j Server</a> <code>$NEO4J_HOME/plugins</code> directory.
After restarting the server, you should be able to use the following <strong>procedure calls</strong> from the Cypher query language.</p>
</div>
<table id="table-all" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Available Spatial Procedures</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 44.4444%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">description</th>
<th class="tableblock halign-left valign-top">signature</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.addLayer"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Adds a new layer with the given type (see spatial.getAllLayerTypes) and configuration, returns the layer root node"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.addLayer(name :: STRING?, type :: STRING?, encoderConfig :: STRING?) :: (node :: NODE?)"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.addLayerWithEncoder"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Adds a new layer with the given encoder class and configuration, returns the layer root node"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.addLayerWithEncoder(name :: STRING?, encoder :: STRING?, encoderConfig :: STRING?) :: (node :: NODE?)"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.addNode"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Adds the given node to the layer, returns the geometry-node"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.addNode(layerName :: STRING?, node :: NODE?) :: (node :: NODE?)"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.addNodes"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Adds the given nodes list to the layer, returns the count"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.addNodes(layerName :: STRING?, nodes :: LIST? OF NODE?) :: (count :: INTEGER?)"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.addPointLayer"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Adds a new simple point layer, returns the layer root node"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.addPointLayer(name :: STRING?) :: (node :: NODE?)"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.addPointLayerWithConfig"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Adds a new simple point layer with the given configuration, returns the layer root node"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.addPointLayerWithConfig(name :: STRING?, encoderConfig :: STRING?) :: (node :: NODE?)"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.addPointLayerXY"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Adds a new simple point layer with the given properties for x and y coordinates, returns the layer root node"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.addPointLayerXY(name :: STRING?, xProperty :: STRING?, yProperty :: STRING?) :: (node :: NODE?)"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.addWKT"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Adds the given WKT string to the layer, returns the created geometry node"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.addWKT(layerName :: STRING?, geometry :: STRING?) :: (node :: NODE?)"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.addWKTLayer"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Adds a new WKT layer with the given node property to hold the WKT string, returns the layer root node"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.addWKTLayer(name :: STRING?, nodePropertyName :: STRING?) :: (node :: NODE?)"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.addWKTs"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Adds the given WKT string list to the layer, returns the created geometry nodes"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.addWKTs(layerName :: STRING?, geometry :: LIST? OF STRING?) :: (node :: NODE?)"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.asExternalGeometry"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Returns a geometry object as an external geometry type to be returned to a client"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.asExternalGeometry(geometry :: ANY?) :: (geometry :: ANY?)"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.asGeometry"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Returns a geometry object as an internal cypher geometry type, to be passed to other procedures but not returned to a client"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.asGeometry(geometry :: ANY?) :: (geometry :: ANY?)"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.bbox"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Finds all geometry nodes in the given layer within the lower left and upper right coordinates of a box"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.bbox(layerName :: STRING?, min :: ANY?, max :: ANY?) :: (node :: NODE?)"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.closest"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Finds all geometry nodes in the layer within the distance to the given coordinate"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.closest(layerName :: STRING?, coordinate :: ANY?, distanceInKm :: FLOAT?) :: (node :: NODE?)"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.decodeGeometry"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Returns a geometry of a layer node as internal cypher geometry type, to be passed to other procedures but not returned to a client"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.decodeGeometry(layerName :: STRING?, node :: NODE?) :: (geometry :: ANY?)"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.getFeatureAttributes"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Returns feature attributes of the given layer"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.getFeatureAttributes(name :: STRING?) :: (name :: STRING?)"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.importOSM"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Imports the provided osm-file from URI to a layer of the same name, returns the count of data added"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.importOSM(uri :: STRING?) :: (count :: INTEGER?)"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.importOSMToLayer"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Imports the provided osm-file from URI to a layer, returns the count of data added"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.importOSMToLayer(layerName :: STRING?, uri :: STRING?) :: (count :: INTEGER?)"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.importShapefile"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Imports the provided shape-file from URI to a layer of the same name, returns the count of data added"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.importShapefile(uri :: STRING?) :: (count :: INTEGER?)"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.importShapefileToLayer"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Imports the provided shape-file from URI to the given layer, returns the count of data added"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.importShapefileToLayer(layerName :: STRING?, uri :: STRING?) :: (count :: INTEGER?)"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.intersects"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Returns all geometry nodes that intersect the given geometry (shape, polygon) in the layer"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.intersects(layerName :: STRING?, geometry :: ANY?) :: (node :: NODE?)"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.layer"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Returns the layer root node for the given layer name"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.layer(name :: STRING?) :: (node :: NODE?)"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.layerTypes"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Returns the different registered layer types"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.layerTypes() :: (name :: STRING?, signature :: STRING?)"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.layers"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Returns name, and details for all layers"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.layers() :: (name :: STRING?, signature :: STRING?)"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.procedures"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Lists all spatial procedures with name and signature"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.procedures() :: (name :: STRING?, signature :: STRING?)"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.removeLayer"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Removes the given layer"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.removeLayer(name :: STRING?) :: VOID"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.setFeatureAttributes"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Sets the feature attributes of the given layer"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.setFeatureAttributes(name :: STRING?, attributeNames :: LIST? OF STRING?) :: (node :: NODE?)"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.updateFromWKT"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Internal procedure, updates the geometry node with the given id with a new WKT string"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.updateFromWKT(layerName :: STRING?, geometry :: STRING?, geometryNodeId :: INTEGER?) :: (node :: NODE?)"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.withinDistance"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Returns all geometry nodes and their ordered distance in the layer within the distance to the given coordinate"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"spatial.withinDistance(layerName :: STRING?, coordinate :: ANY?, distanceInKm :: FLOAT?) :: (node :: NODE?, distance :: FLOAT?)"</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="spatial-querying">Querying</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_jts_queries">JTS Queries</h3>
<div class="paragraph">
<p>Neo4j-Spatial contains the 'Java Topology Suite', a library of geometries and geometry operations. In fact, whenever we use the term 'Geometry' we are refering to the JTS class Geometry. Likewise, the subclasses of Geometry: Point, LineString, Polygon and others are all from JTS.
This means that you can use all the capabilities of JTS to operate on Geometry instances you obtain from the database. If, for example, you perform a search for geometries in a certain area, you will be able to
iterate over the results and for each geometry returned, call JTS methods on that class. For example, you could call geometry.</p>
</div>
<div class="paragraph">
<p>But
The spatial queries implemented are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Contain</p>
</li>
<li>
<p>Cover</p>
</li>
<li>
<p>Covered By</p>
</li>
<li>
<p>Cross</p>
</li>
<li>
<p>Disjoint</p>
</li>
<li>
<p>Intersect</p>
</li>
<li>
<p>Intersect Window</p>
</li>
<li>
<p>Overlap</p>
</li>
<li>
<p>Touch</p>
</li>
<li>
<p>Within</p>
</li>
<li>
<p>Within Distance</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spatial-examples">Examples</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="spatial-import-shapefile">Importing a shapefile</h3>
<div class="paragraph">
<p>Neo4j-Spatial includes a utility for importing ESRI Shapefile data. The ShapefileImporter will create a new Layer for each Shapefile imported, and will store each Geometry as WKB in a single property of a single node. All attributes of the Feature will be stored as additional properties of that node. For more information on how this is implemented, you can refer to the classes WKBGeometryEncoder. However, you do not need to know any of that to use this feature. Consider the simple code below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ShapefileImporter importer = <span style="color:#080;font-weight:bold">new</span> ShapefileImporter(database);
importer.importFile(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">shp/highway.shp</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">highway</span><span style="color:#710">&quot;</span></span>, StandardCharsets.UTF_8);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code will import the layer 'highway' from the file 'shp/highway.shp' which is included in the source distribution. This layer will be indexed using an RTree and can therefore be queried using any of the supported spatial operations. See the example on querying layers below.</p>
</div>
</div>
<div class="sect2">
<h3 id="spatial-import-osm">Importing an Open Street Map file</h3>
<div class="paragraph">
<p>This is more complex because the current OSMImporter class runs in two phases, the first requiring a batch-inserter on the database.
The is ongoing work to allow for a non-batch-inserter on the entire process, and possibly when you have read this that will already be available.
Refer to the unit tests in classes TestDynamicLayers and TestOSMImport for the latest code for importing OSM data. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">OSMImporter importer = <span style="color:#080;font-weight:bold">new</span> OSMImporter(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">map.osm</span><span style="color:#710">&quot;</span></span>);
importer.setCharset(StandardCharsets.UTF_8);
importer.importFile(db, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">map.osm</span><span style="color:#710">&quot;</span></span>);
importer.reIndex(db);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code will import the map.osm Open Street Map file, populating the database with a little over 200 geometries, including streets, buildings and points of interest.</p>
</div>
</div>
<div class="sect2">
<h3 id="spatial-spatial-query">Executing a spatial query</h3>
<div class="paragraph">
<p>Assuming you imported the map.osm file as in the previous example, you can now perform spatial searches on the data. The following example will search within a rectangle for a whatever geometries it can find:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SpatialDatabaseService spatial = <span style="color:#080;font-weight:bold">new</span> SpatialDatabaseService(
                <span style="color:#080;font-weight:bold">new</span> IndexManager((GraphDatabaseAPI) graphDb, SecurityContext.AUTH_DISABLED));
<span style="color:#080;font-weight:bold">try</span> (Transaction tx = database.beginTx()) {
        Layer layer = spatial.getLayer(tx, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">map.osm</span><span style="color:#710">&quot;</span></span>);
        LayerIndexReader spatialIndex = layer.getIndex();
        <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Have </span><span style="color:#710">&quot;</span></span> + spatialIndex.count(tx) + <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20"> geometries in </span><span style="color:#710">&quot;</span></span> + spatialIndex.getBoundingBox(tx));

        Envelope bbox = <span style="color:#080;font-weight:bold">new</span> Envelope(<span style="color:#60E">12.94</span>, <span style="color:#60E">12.96</span>, <span style="color:#60E">56.04</span>, <span style="color:#60E">56.06</span>);
        <span style="color:#0a8;font-weight:bold">List</span>&lt;SpatialDatabaseRecord&gt; results = GeoPipeline
                        .startIntersectWindowSearch(tx, layer, bbox)
                        .toSpatialDatabaseRecordList();

        doGeometryTestsOnResults(bbox, results);
        tx.commit();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more examples of query code, refer to the test code in the LayerTest and the SpatialTest classes.
Also review the classes in the org.neo4j.gis.spatial.query package for the full range or search queries currently implemented.</p>
</div>
</div>
<div class="sect2">
<h3 id="spatial-export-shapefile">Export a shapefile</h3>
<div class="paragraph">
<p>The ESRI Shapefile that we imported in the first example above was actually created by Neo4j-Spatial. It is possible to use the results of a query, or a DynamicLayer, to create a new Shapefile using the ShapefileExporter. If we were to export the complete layer created from importing a shapefile, we would not achieve much, but we could use this capability to create shapefiles that are subsets of other layers, or that are created from data in another format.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SpatialDatabaseService spatial = <span style="color:#080;font-weight:bold">new</span> SpatialDatabaseService(
                <span style="color:#080;font-weight:bold">new</span> IndexManager((GraphDatabaseAPI) graphDb, SecurityContext.AUTH_DISABLED));
<span style="color:#0a8;font-weight:bold">String</span> wayLayerName;
<span style="color:#080;font-weight:bold">try</span> (Transaction tx = database.beginTx()) {
        OSMLayer layer = (OSMLayer) spatial.getLayer(tx, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">map.osm</span><span style="color:#710">&quot;</span></span>);
        DynamicLayerConfig wayLayer = layer.addSimpleDynamicLayer(tx, Constants.GTYPE_LINESTRING);
        wayLayerName = wayLayer.getName();
        tx.commit();
}
ShapefileExporter shpExporter = <span style="color:#080;font-weight:bold">new</span> ShapefileExporter(database);
shpExporter.exportLayer(wayLayerName);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example shows how we can import an OSM dataset, which contains data with a number of different Geometry types, and then by using a DynamicLayer to select for only geometries of type 'LineString', we can export all the OSM ways to a Shapefile. This is particularly important when you consider that ESRI Shapefile format does not allow more than one Geometry type per shapefile.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SpatialDatabaseService spatial = <span style="color:#080;font-weight:bold">new</span> SpatialDatabaseService(
                <span style="color:#080;font-weight:bold">new</span> IndexManager((GraphDatabaseAPI) graphDb, SecurityContext.AUTH_DISABLED));
Envelope bbox = <span style="color:#080;font-weight:bold">new</span> Envelope(<span style="color:#60E">12.94</span>, <span style="color:#60E">12.96</span>, <span style="color:#60E">56.04</span>, <span style="color:#60E">56.06</span>);
<span style="color:#0a8;font-weight:bold">List</span>&lt;SpatialDatabaseRecord&gt; results;
<span style="color:#080;font-weight:bold">try</span> (Transaction tx = database.beginTx()) {
        Layer layer = spatial.getLayer(tx, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">map.osm</span><span style="color:#710">&quot;</span></span>);
        LayerIndexReader spatialIndex = layer.getIndex();
        <span style="color:#0a8;font-weight:bold">System</span>.out.println(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Have </span><span style="color:#710">&quot;</span></span> + spatialIndex.count(tx) + <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20"> geometries in </span><span style="color:#710">&quot;</span></span> + spatialIndex.getBoundingBox(tx));

        results = GeoPipeline
                        .startIntersectWindowSearch(tx, layer, bbox)
                        .toSpatialDatabaseRecordList();

        spatial.createResultsLayer(tx, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">results</span><span style="color:#710">&quot;</span></span>, results);
        tx.commit();

}
ShapefileExporter shpExporter = <span style="color:#080;font-weight:bold">new</span> ShapefileExporter(database);
shpExporter.exportLayer(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">results</span><span style="color:#710">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This time we import the same OSM model, but query for all geometries inside an envelope, and export that to a new Shapefile.</p>
</div>
</div>
<div class="sect2">
<h3 id="spatial-geopipes">GeoPipes</h3>
<div class="sect3">
<h4 id="_base_layers">Base Layers</h4>
<div class="paragraph">
<p>These are the different base layers being used for the following examples:</p>
</div>
<div class="paragraph">
<p>OsmLayer:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/osmLayer.png" alt="osmLayer">
</div>
</div>
<div class="paragraph">
<p>IntersectionLayer:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/intersectionLayer.png" alt="intersectionLayer">
</div>
</div>
<div class="paragraph">
<p>LinesLayer:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/linesLayer.png" alt="linesLayer">
</div>
</div>
<div class="paragraph">
<p>BoxesLayer:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/boxesLayer.png" alt="boxesLayer">
</div>
</div>
<div class="paragraph">
<p>ConcaveLayer:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/concaveLayer.png" alt="concaveLayer">
</div>
</div>
<div class="paragraph">
<p>EqualLayer:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/equalLayer.png" alt="equalLayer">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_geopipes_examples">GeoPipes Examples</h3>
<div class="paragraph">
<p>Below follows a non-exhaustive lists of interesting GeoPipes that can be chained together to contruct a geoprocessing system in while trying to keep the processing as lazy as possible using iterators through the different steps.</p>
</div>
<div class="sect3">
<h4 id="_search_within_geometry">Search within geometry</h4>
<div class="paragraph">
<p>This pipe performs a search within a geometry in this example, both OSM street geometries should be found in when searching with an enclosing rectangle Envelope.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GeoPipeline pipeline = GeoPipeline
                .startWithinSearch(tx, osmLayer,
                                osmLayer.getGeometryFactory().toGeometry(<span style="color:#080;font-weight:bold">new</span> Envelope(<span style="color:#00D">10</span>, <span style="color:#00D">20</span>, <span style="color:#00D">50</span>, <span style="color:#00D">60</span>)));</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_intersecting_windows">Intersecting windows</h4>
<div class="paragraph">
<p>The FilterIntersectWindow pipe finds geometries that intersects a given rectangle. This pipeline:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GeoPipeline pipeline = GeoPipeline
                .start(tx, boxesLayer)
                .windowIntersectionFilter(<span style="color:#080;font-weight:bold">new</span> Envelope(<span style="color:#00D">0</span>, <span style="color:#00D">10</span>, <span style="color:#00D">0</span>, <span style="color:#00D">10</span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>will output:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/intersecting_windows.png" alt="intersecting windows">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_intersect_all">Intersect All</h4>
<div class="paragraph">
<p>The IntersectAll pipe intersects geometries of every item contained in the pipeline.
It groups every item in the pipeline in a single item containing the geometry output of the intersection.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GeoPipeline pipeline = GeoPipeline.start(tx, intersectionLayer).intersectAll();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/intersect_all.png" alt="intersect all">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_unite_all">Unite All</h4>
<div class="paragraph">
<p>The Union All pipe unites geometries of every item contained in the pipeline. This pipe groups every item in the pipeline in a single item containing the geometry output of the union.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GeoPipeline pipeline = GeoPipeline.start(tx, intersectionLayer).unionAll();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/unite_all.png" alt="unite all">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_extract_points">Extract Points</h4>
<div class="paragraph">
<p>The Extract Points pipe extracts every point from a geometry.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GeoPipeline pipeline = GeoPipeline.start(tx, boxesLayer).extractPoints();</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/extract_points.png" alt="extract points">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_filter_by_cql_using_complex_cql">Filter by cql using complex cql</h4>
<div class="paragraph">
<p>This filter will apply the provided CQL expression to the different geometries and only let the matching ones pass.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#339;font-weight:bold">long</span> counter = GeoPipeline.start(tx, osmLayer)
                .cqlFilter(tx, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">highway is not null and geometryType(the_geom) = 'LineString'</span><span style="color:#710">&quot;</span></span>).count();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_boundary">Boundary</h4>
<div class="paragraph">
<p>The boundary pipe calculates boundary of every geometry in the pipeline.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GeoPipeline pipeline = GeoPipeline.start(tx, boxesLayer).toBoundary();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/boundary.png" alt="boundary">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_centroid">Centroid</h4>
<div class="paragraph">
<p>The Centroid pipe calculates geometry centroid.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GeoPipeline pipeline = GeoPipeline.start(tx, boxesLayer).toCentroid();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/centroid.png" alt="centroid">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_convex_hull">Convex Hull</h4>
<div class="paragraph">
<p>The ConvexHull pipe calculates geometry convex hull.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GeoPipeline pipeline = GeoPipeline.start(tx, concaveLayer).toConvexHull();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/convex_hull.png" alt="convex hull">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_densify">Densify</h4>
<div class="paragraph">
<p>The Densify pipe inserts extra vertices along the line segments in the geometry. The densified geometry contains no line segment which is longer than the given distance tolerance.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GeoPipeline pipeline = GeoPipeline.start(tx, concaveLayer).densify(<span style="color:#00D">5</span>).extractPoints();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/densify.png" alt="densify">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_envelope">Envelope</h4>
<div class="paragraph">
<p>The Envelope pipe computes the minimum bounding box of item geometry.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GeoPipeline pipeline = GeoPipeline
                .start(tx, linesLayer)
                .toEnvelope();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/envelope.png" alt="envelope">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_export_to_gml">Export to GML</h4>
<div class="paragraph">
<p>This pipe exports every geometry as a GML snippet.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GeoPipeline pipeline = GeoPipeline.start(tx, boxesLayer).createGML();
<span style="color:#080;font-weight:bold">for</span> (GeoPipeFlow flow : pipeline) {
        <span style="color:#0a8;font-weight:bold">System</span>.out.println(flow.getProperties().get(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">GML</span><span style="color:#710">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;gml:Polygon&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;gml:outerBoundaryIs&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;gml:LinearRing&gt;</span>
                        <span style="color:#070;font-weight:bold">&lt;gml:coordinates&gt;</span>
                                12.0,26.0 12.0,27.0 13.0,27.0 13.0,26.0 12.0,26.0
                        <span style="color:#070;font-weight:bold">&lt;/gml:coordinates&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;/gml:LinearRing&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/gml:outerBoundaryIs&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/gml:Polygon&gt;</span>
<span style="color:#070;font-weight:bold">&lt;gml:Polygon&gt;</span>
<span style="color:#070;font-weight:bold">&lt;gml:outerBoundaryIs&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;gml:LinearRing&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;gml:coordinates&gt;</span>
                        2.0,3.0 2.0,5.0 6.0,5.0 6.0,3.0 2.0,3.0
                <span style="color:#070;font-weight:bold">&lt;/gml:coordinates&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/gml:LinearRing&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/gml:outerBoundaryIs&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/gml:Polygon&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_intersection">Intersection</h4>
<div class="paragraph">
<p>The Intersection pipe computes a geometry representing the intersection between item geometry and the given geometry.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">WKTReader reader = <span style="color:#080;font-weight:bold">new</span> WKTReader(intersectionLayer.getGeometryFactory());
Geometry geometry = reader.read(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">POLYGON ((3 3, 3 5, 7 7, 7 3, 3 3))</span><span style="color:#710">&quot;</span></span>);
GeoPipeline pipeline = GeoPipeline.start(tx, intersectionLayer).intersect(geometry);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/intersection.png" alt="intersection">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_union">Union</h4>
<div class="paragraph">
<p>The Union pipe unites item geometry with a given geometry.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">WKTReader reader = <span style="color:#080;font-weight:bold">new</span> WKTReader(intersectionLayer.getGeometryFactory());
Geometry geometry = reader.read(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">POLYGON ((3 3, 3 5, 7 7, 7 3, 3 3))</span><span style="color:#710">&quot;</span></span>);
SearchFilter filter = <span style="color:#080;font-weight:bold">new</span> SearchIntersectWindow(intersectionLayer, <span style="color:#080;font-weight:bold">new</span> Envelope(<span style="color:#00D">7</span>, <span style="color:#00D">10</span>, <span style="color:#00D">7</span>, <span style="color:#00D">10</span>));
GeoPipeline pipeline = GeoPipeline.start(tx, intersectionLayer, filter).union(geometry);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/union.png" alt="union">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_start_point">Start Point</h4>
<div class="paragraph">
<p>The StartPoint pipe finds the starting point of item geometry.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GeoPipeline pipeline = GeoPipeline
                .start(tx, linesLayer)
                .toStartPoint();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/start_point.png" alt="start point">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_end_point">End Point</h4>
<div class="paragraph">
<p>The EndPoint pipe finds the ending point of item geometry.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GeoPipeline pipeline = GeoPipeline
                .start(tx, linesLayer)
                .toEndPoint();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/end_point.png" alt="end point">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_max">Max</h4>
<div class="paragraph">
<p>The Max pipe computes the maximum value of the specified property and discard items with a value less than the maximum.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GeoPipeline pipeline = GeoPipeline.start(tx, boxesLayer)
                .calculateArea()
                .getMax(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Area</span><span style="color:#710">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/max.png" alt="max">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_min">Min</h4>
<div class="paragraph">
<p>The Min pipe computes the minimum value of the specified property and discard items with a value greater than the minimum.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GeoPipeline pipeline = GeoPipeline.start(tx, boxesLayer)
                .calculateArea()
                .getMin(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Area</span><span style="color:#710">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/min.png" alt="min">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_break_up_all_geometries_into_points_and_make_density_islands">Break up all geometries into points and make density islands</h4>
<div class="paragraph">
<p>A more complex Open Street Map example.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#777">//step1</span>
GeoPipeline pipeline = OSMGeoPipeline.startOsm(tx, osmLayer)
                <span style="color:#777">//step2</span>
                .extractOsmPoints()
                <span style="color:#777">//step3</span>
                .groupByDensityIslands(<span style="color:#60E">0.0005</span>)
                <span style="color:#777">//step4</span>
                .toConvexHull()
                <span style="color:#777">//step5</span>
                .toBuffer(<span style="color:#60E">0.0004</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/step1_break_up_all_geometries_into_points_and_make_density_islands.png" alt="step1 break up all geometries into points and make density islands">
</div>
<div class="title">Figure 1. Step1</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/step2_break_up_all_geometries_into_points_and_make_density_islands.png" alt="step2 break up all geometries into points and make density islands">
</div>
<div class="title">Figure 2. Step2</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/step3_break_up_all_geometries_into_points_and_make_density_islands.png" alt="step3 break up all geometries into points and make density islands">
</div>
<div class="title">Figure 3. Step3</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/step4_break_up_all_geometries_into_points_and_make_density_islands.png" alt="step4 break up all geometries into points and make density islands">
</div>
<div class="title">Figure 4. Step4</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/step5_break_up_all_geometries_into_points_and_make_density_islands.png" alt="step5 break up all geometries into points and make density islands">
</div>
<div class="title">Figure 5. Step5</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_appendix_integrations">Appendix: Integrations</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_neo4j_spatial_in_udig">Neo4j Spatial in uDig</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Neo4j Spatial supports Geotools, and therefor also Geotools based platforms like GeoServer and uDig. For information on setting up and running Neo4j Spatial in GeoServer, see the wiki page <a href="#geoserver">[geoserver]</a>.</p>
</div>
<div class="sect2">
<h3 id="_udig_sdk">uDig SDK</h3>
<div class="paragraph">
<p>Here we will discuss how to set up a development environment for developing code for uDig making use of Neo4j Spatial. For example, if you want to build a uDig plugin that makes use of Neo4j for the data model, or if you have a custom extension to Neo4j Spatial, and want to visualize the data in uDig.</p>
</div>
</div>
<div class="sect2">
<h3 id="_setting_up_udig_sdk">Setting up uDig SDK</h3>
<div class="paragraph">
<p>Follow the uDig SDK Quickstart instructions on the uDig wiki at <a href="http://udig.refractions.net/confluence/display/DEV/1+SDK+Quickstart" class="bare">http://udig.refractions.net/confluence/display/DEV/1+SDK+Quickstart</a>. It is best to follow those instructions in detail, since all steps are explained and alternatives given. However, for the impatient and foolish, we include simplified instructions here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install Eclipse for RCP and EMF from <a href="http://www.eclipse.org/downloads" class="bare">http://www.eclipse.org/downloads</a> (should work with Eclipse 3.5.x and 3.6.x)</p>
</li>
<li>
<p>Install extra plugins or 'dropins' from <a href="http://udig.refractions.net/files/downloads/extras/" class="bare">http://udig.refractions.net/files/downloads/extras/</a></p>
</li>
<li>
<p>Install an extended JRE from <a href="http://udig.refractions.net/files/downloads/jre/" class="bare">http://udig.refractions.net/files/downloads/jre/</a></p>
</li>
<li>
<p>Install and RCP delta pack from <a href="http://download.eclipse.org/eclipse/downloads/" class="bare">http://download.eclipse.org/eclipse/downloads/</a></p>
</li>
<li>
<p>Install the uDig SDK from <a href="http://udig.refractions.net/files/downloads/branches/udig-1.2-SNAPSHOT-sdk.zip" class="bare">http://udig.refractions.net/files/downloads/branches/udig-1.2-SNAPSHOT-sdk.zip</a></p>
</li>
<li>
<p>Make sure your eclipse uses the downloaded JRE, has the dropins in its dropins folder and has the delta-pack and uDig SDK unpacked into a separate location.</p>
</li>
<li>
<p>In eclipse, set up the RCP target platform to include the SDK and delta-pack directories</p>
</li>
<li>
<p>Switch to the RCP perspective, use the plugins view to find the net.refractions.udig plugin and import it as a source project.</p>
</li>
<li>
<p>Double-click the 'udig.product' file to open it in the editors view, and then click the 'Launch and Eclipse Application'
You should now have a running uDig, launched from the IDE. We can now move on and add Neo4j Spatial and its dependencies to the project. Shutdown uDig and move to the next section.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_adding_neo4j_spatial">Adding Neo4j Spatial</h3>
<div class="paragraph">
<p>Versions and Dependencies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Note that the trunk version of Neo4j Spatial requires uDig 1.2.1, which was not yet released at the time of writing. However, there was a SNAPSHOT build available at <a href="http://udig.refractions.net/files/downloads/branches" class="bare">http://udig.refractions.net/files/downloads/branches</a>, dated 10th September. If you cannot find a SNAPSHOT SDK at that date, or more recent, then look in the normal location, or consider building the SDK yourself according to the instructions athttp://udig.refractions.net/confluence/display/ADMIN/02+Development+Environment</p>
</li>
<li>
<p>If you wish to use uDig 1.2.0 official release, then you need to use an older version of Neo4j Spatial. Specifically any version earlier than the upgrade to GeoTools 2.7 which occurred on the 1st October.
Adding Neo4j Spatial to uDig:</p>
</li>
<li>
<p>Install Maven2 support for Eclipse:</p>
</li>
<li>
<p>Go to 'Help&#8594;Install New Software' and add a new update site for M2Eclipse using URL <a href="http://m2eclipse.sonatype.org/sites/m2e" class="bare">http://m2eclipse.sonatype.org/sites/m2e</a></p>
</li>
<li>
<p>Select and install the maven integration for eclipse</p>
</li>
<li>
<p>Get the source code for Neo4j Spatial using: git clone git://github.com/neo4j/neo4j-spatial.git</p>
</li>
<li>
<p>If you need to use the GeoTools 2.6 version of Neo4j Spatial:</p>
</li>
<li>
<p>Switch to the end of September version using the command: git checkout 04a0ae</p>
</li>
<li>
<p>If you plan to develop Neo4j Spatial code from this point, consider making a branch first by going to the newly created directory, typing 'git branch yourbranchname' followed by 'git checkout yourbranchname'</p>
</li>
<li>
<p>Compile and test the code using: mvn test</p>
</li>
<li>
<p>This should download all dependencies and run some test cases to make sure everything is OK</p>
</li>
<li>
<p>Get the source code for eu.udig.catalog.neo4j using: git clone git://gitorious.org/udig-community/neo4j.git eu.udig.catalog.neo4j</p>
</li>
<li>
<p>you can branch this as well</p>
</li>
<li>
<p>Start eclipse and import the two projects into the workspace</p>
</li>
<li>
<p>Use 'File&#8594;Import&#8594;General&#8594;Existing Projects into Workspace'</p>
</li>
<li>
<p>Browse to the location of your git projects and select and import the neo4j-spatial and eu.udig.catalog.neo4j projects</p>
</li>
<li>
<p>Create a libs project that wraps some dependent jars</p>
</li>
<li>
<p>Use 'New Project&#8594;Plug-in Development&#8594;Plug-in from existing JAR archives'</p>
</li>
<li>
<p>The files you need to add would have been installed by maven during the 'mvn test' of neo4j-spatial above (on Windows possibly in your User\Username\.m2\repository folder) but can also be downloaded separately</p>
</li>
<li>
<p>Select the JAR files to add to the libs project:</p>
</li>
<li>
<p>neo4j-kernel-1.2-1.2.jar</p>
</li>
<li>
<p>neo4j-index-1.2-1.2.jar</p>
</li>
<li>
<p>neo4j-graph-algo-0.7-1.2.jar</p>
</li>
<li>
<p>geronimo-jta_1.1_spec-1.1.1.jar</p>
</li>
<li>
<p>org.apache.servicemix.bundles.lucene-3.0.1_2.jar</p>
</li>
<li>
<p>json-simple-1.1.jar</p>
</li>
<li>
<p>Choose a name like 'org.neo4j.spatial.libs' and create the project</p>
</li>
<li>
<p>Open the new libs projects MANIFEST.MF file and exit the exports to include all packages in the jars</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_testing_sample_layers_in_udig">Testing sample layers in uDig</h3>
<div class="paragraph">
<p>When Neo4j Spatial was first installed above, you used 'mvn test' to run some test cases. This will have created a neo4j database with one or more layers, which you can use to display in uDig. However, we will take more control over this by specifically re-running one of the test cases, so we know exactly which layers will be visible.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Navigate to the test code for TestDynamicLayers, right click and choose 'Run as &#8594; JUnit Test'</p>
</li>
<li>
<p>This test case will load an OSM dataset for the city of Malmö in Sweden. It will then assign a number of 'dynamic layers', which are pre-configured filters of the dataset, designed to look like separate layers in the GIS, but in reality being views of the same connected graph in the database.</p>
</li>
<li>
<p>The test will also export these layers as both Shapefile and PNG images for testing purposes in neo4j-spatial\target\export. We will not need them for uDig, since we will be streaming the data directly into the view in uDig. However, you can compare these in uDig later to see the differences.</p>
</li>
<li>
<p>Open the run configurations dialog and look at the run configuration for uDig that was created earlier when you first ran uDig.</p>
</li>
<li>
<p>Check the plugins tab and make sure that the two new plugins in your workspace are selected:</p>
</li>
<li>
<p>org.neo4j.spatial</p>
</li>
<li>
<p>org.neo4j.spatial.libs</p>
</li>
<li>
<p>eu.udig.catalog.neo4j</p>
</li>
<li>
<p>Click 'Validate plugins' and optionally 'Add required plugins' to ensure that all dependencies are met (if needed edit the manifest.mf files of both eu.udig.catalog.neo4j and neo4j-spatial to mark the management dependencies optional: org.neo4j.kernel.impl.management;resolution:=optional, and org.neo4j.kernel.management;resolution:=optional)</p>
</li>
<li>
<p>Some errors in the projects may be due to invalid characters, such as in 'crossing_bygg_fÃ¶rstadsgatan'. Simply replace it with another name.</p>
</li>
<li>
<p>Optionally check 'clear workspace' on the main tab</p>
</li>
<li>
<p>Click the 'Run' button to run uDig with Neo4j support enabled</p>
</li>
<li>
<p>Once it has started, the eu.udig.catalog.neo4j plugin will scan your home directory for neo4j databases. In the catalog view you should see the one created by the unit test code. If you do not find one, you can import one:</p>
</li>
<li>
<p>Right click in the catalog view and choose 'Import&#8594;Data&#8594;Files'</p>
</li>
<li>
<p>Select the neostore-id file in the database directory to add this database to the catalog</p>
</li>
<li>
<p>Select one or more layers in the catalog and add them to the current map.</p>
</li>
<li>
<p>If you select the map2.osm layer, you will get a single layer containing all geometry types recognized as Geometries in the database</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Udig-map2.png" alt="Udig map2">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>If you select one of the other layers, you will get a filtered view of only that data</p>
</li>
<li>
<p>Adding multiple layers to the map allows you to reorder the layers and modify their styling separately.</p>
</li>
<li>
<p>Optionally change the projection to look better for northern latitudes:</p>
</li>
<li>
<p>Click on the projection button below the map, which initially says 'WGS84'</p>
</li>
<li>
<p>Type 'RT90' into the filter, and then select 'RT90 2.5 gon V (3021)'. This is a common Swedish projection and so will work well for Malmö.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Udig-map2-rt90.png" alt="Udig map2 rt90">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Try set the style for the map2.osm layer using the sample style file in the Neo4j Spatial source code: neo.sld.xml</p>
</li>
<li>
<p>Turn off all layers but map2.osm in the layers view, to keep the view simple</p>
</li>
<li>
<p>Right-click on the map2.osm layer in the layers view and choose 'Style'</p>
</li>
<li>
<p>Go to the 'XML' option, and mark all XML and delete it</p>
</li>
<li>
<p>Open neo.sld.xml in a text editor, select all the text and copy and paste it into the Style editor</p>
</li>
<li>
<p>Click apply and see the map redraw with more complex styling</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Udig-map2-styled.png" alt="Udig map2 styled">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_update_new_automatic_styles_for_osm">Update: New automatic styles for OSM</h3>
<div class="paragraph">
<p>As of the 20th October (commit 506ee4), OSM layers now publish default styles to the GIS. The initial styles are quite simple, but this does allow for nicer out the box experience. Currently, the code will only work in a development environment with certain directory structure, but we&#8217;ll make it more generic soon.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Udig-multi-styled-layers.png" alt="Udig multi styled layers">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spatial-geoserver">Neo4j Spatial Geoserver Plugin</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Tested with: GeoServer 2.1.1
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="spatial-geoserver-building">Building</h3>
<div class="listingblock">
<div class="content">
<pre>mvn clean install</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spatial-geoserver-deployment">Deployment into Geoserver</h3>
<div class="ulist">
<ul>
<li>
<p>unzip the target/xxxx-server-plugin.zip into $GEOSERVER_HOME/webapps/geoserver/WEB-INF/lib</p>
</li>
<li>
<p>restart geoserver</p>
</li>
<li>
<p>configure a new workspace</p>
</li>
<li>
<p>configure a new datasource neo4j in your workspace. Point the "The directory path of the Neo4j database:" parameter to the relative (form the GeoServer working dir) or aboslute path to a Neo4j Spatial database with layers (see <a href="https://github.com/neo4j/spatial">Neo4j Spatial</a>)</p>
</li>
<li>
<p>in Layers, do "Add new resource" and choose your Neo4j datastore to see the exisitng Neo4j Spatial layers and add them.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="spatial-geoserver-trunk">Testing in GeoServer trunk</h3>
<div class="ulist">
<ul>
<li>
<p>check out the geoserver source</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>svn co https://svn.codehaus.org/geoserver/trunk geoserver-trunk</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>build the source</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>cd geoserver-trunk
mvn clean install</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>check that you can run the web app as of <a href="http://docs.geoserver.org/latest/en/developer/maven-guide/index.html#running-the-web-module-with-jetty">The GeoServer Maven build guide</a></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>cd src/web/app
mvn jetty:run</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>in $GEOSERVER_SOURCE/src/web/app/pom.xml (<a href="https://svn.codehaus.org/geoserver/trunk/src/web/app/pom.xml" class="bare">https://svn.codehaus.org/geoserver/trunk/src/web/app/pom.xml</a>), add the following lines under the profiles section:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>    &lt;profile&gt;
      &lt;id&gt;neo4j&lt;/id&gt;
      &lt;dependencies&gt;
        &lt;dependency&gt;
          &lt;groupId&gt;org.neo4j&lt;/groupId&gt;
          &lt;artifactId&gt;neo4j-spatial&lt;/artifactId&gt;
          &lt;version&gt;0.7-SNAPSHOT&lt;/version&gt;
        &lt;/dependency&gt;
      &lt;/dependencies&gt;
    &lt;/profile&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>start the GeoServer webapp again with the added neo4j profile</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>cd $GEOSERVER_SRC/src/web/app
mvn jetty:run -Pneo4j</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>find Neo4j installed as a datasource under <a href="http://localhost:8080" class="bare">http://localhost:8080</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more info head over to <a href="http://wiki.neo4j.org/content/Neo4j_Spatial_in_GeoServer">Neo4j Wiki on Geoserver</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_neo4j_spatial_in_geoserver">Neo4j Spatial in GeoServer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Neo4j Spatial includes built-in support for a GeoTools data store. This means it is, in principle, directly usable inside GeoServer. This document will discuss how to get it up and running in GeoServer. If you are interested in a desktop GIS, take a look at Neo4j Spatial in uDig.</p>
</div>
<div class="sect2">
<h3 id="_installing_neo4j_spatial_in_geoserver">Installing Neo4j-Spatial in GeoServer</h3>
<div class="sect3">
<h4 id="_installing_geoserver">Installing GeoServer</h4>
<div class="paragraph">
<p>First of all you need to download and install geoserver from <a href="http://geoserver.org/display/GEOS/Download" class="bare">http://geoserver.org/display/GEOS/Download</a>. For detailed installation instructions, refer to the official GeoServer documentation athttp://docs.geoserver.org/stable/en/user/installation/index.html
Here we provide very basic instructions, with factors to consider regarding installing GeoServer with Neo4j Spatial:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Choose the right version for the version of Neo4j Spatial you are going to use:</p>
</li>
<li>
<p>Neo4j-Spatial trunk is currently coded to work with GeoTools 2.7, so this means we need to load it into GeoServer 2.1 or later. The version we tested against was geoserver-2.1-beta1</p>
</li>
<li>
<p>If you want to deploy on the stable release of GeoServer 2.0.2, then you can use an older Neo4j-Spatial, or modify the code to work with GeoTools 2.6 (the differences are small). The last version of Neo4j Spatial that works with the GeoServer 2.0 series, is from the end of September 2010.</p>
</li>
<li>
<p>If you already have a servlet container running, you can download the WAR version, otherwise download the BIN version (or the Windows installer if on Windows). Install and run using the included instructions in geoserver.</p>
</li>
<li>
<p>Once installed, open a web browser on <a href="http://localhost:8080/geoserver/web/" class="bare">http://localhost:8080/geoserver/web/</a> (or other location is you configured it differently) to test that geoserver is runnning correctly.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_adding_neo4j_spatial_2">Adding Neo4j Spatial</h4>
<div class="paragraph">
<p>Install Neo4j-Spatial by copying the following JAR files into the in the GeoServer directory webapps/geoserver/WEB-INF/lib:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>json-simple-1.1.jar</p>
</li>
<li>
<p>geronimo-jta_1.1_spec-1.1.1.jar</p>
</li>
<li>
<p>neo4j-kernel-1.2-1.2.M03.jar</p>
</li>
<li>
<p>neo4j-index-1.2-1.2.M03.jar</p>
</li>
<li>
<p>neo4j-spatial.jar</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Getting this last jar can be achieved by using maven to compile from source, or by simply browsing to the maven repository website at <a href="http://m2.neo4j.org/org/neo4j/neo4j-spatial/" class="bare">http://m2.neo4j.org/org/neo4j/neo4j-spatial/</a></p>
</div>
<div class="paragraph">
<p>At the time of writing the latest JAR was:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For GeoTools 2.7 and GeoServer 2.1.x</p>
</li>
<li>
<p><a href="http://m2.neo4j.org/org/neo4j/neo4j-spatial/0.3-SNAPSHOT/neo4j-spatial-0.3-20101021.124131-1.jar" class="bare">http://m2.neo4j.org/org/neo4j/neo4j-spatial/0.3-SNAPSHOT/neo4j-spatial-0.3-20101021.124131-1.jar</a></p>
</li>
<li>
<p>For GeoTools 2.6 and GeoServer 2.0.x</p>
</li>
<li>
<p><a href="http://m2.neo4j.org/org/neo4j/neo4j-spatial/0.2-SNAPSHOT/neo4j-spatial-0.2-20100929.153937-103.jar" class="bare">http://m2.neo4j.org/org/neo4j/neo4j-spatial/0.2-SNAPSHOT/neo4j-spatial-0.2-20100929.153937-103.jar</a>
And then re-start Geoserver.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_visualizing_neo4j_spatial_data_in_geoserver">Visualizing Neo4j Spatial data in GeoServer</h3>
<div class="paragraph">
<p>These instructions lead you through getting started with adding some test layers from Neo4j Spatial to the running GeoServer</p>
</div>
<div class="paragraph">
<p>Login as 'admin' with password 'geoserver', unless you have changed those in the security/users.properties file during installation</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Geoserver-1-logged-in.png" alt="Geoserver 1 logged in">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_add_a_data_source">Add a data source</h3>
<div class="paragraph">
<p>Go to 'Stores' and click 'Add a new Store'</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Geoserver-2-add-new-store.png" alt="Geoserver 2 add new store">
</div>
</div>
<div class="paragraph">
<p>Name the data source and add the path to the Neo4j Database you have your layers in</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Geoserver-3-path-to-neo4j-db.png" alt="Geoserver 3 path to neo4j db">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>One option for the database location is a database created using the unit tests in Neo4j Spatial. The rest of this wiki assumes that you ran the TestDynamicLayers unit test which loads an OSM dataset for the city of Malmö in Sweden, and then creates a number of Dynamic Layers (or views) on this data, which we can publish in GeoServer.</p>
</li>
<li>
<p>If you do use the unit test for the sample database, then the location of the database will be in the target/var/neo4j-db directory of the Neo4j Source code.</p>
</li>
<li>
<p>Type the URL as the full path to the neostore-id file in the database directory</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_publish_from_data_source">Publish from data source</h3>
<div class="paragraph">
<p>Now we will publish a layer from the data source</p>
</div>
<div class="paragraph">
<p>Click 'Neo4j' under 'Vector Data Sources' and then click 'Add new layer'</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Geoserver-5-choose-new-layer.png" alt="Geoserver 5 choose new layer">
</div>
</div>
<div class="paragraph">
<p>Choose the 'Neo4j Data Store'</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Geoserver-6-choose-new-layer2.png" alt="Geoserver 6 choose new layer2">
</div>
</div>
<div class="paragraph">
<p>Choose a layer and click 'Publish'
GeoServer seems to have trouble detecting the CRS and bounds, so we have to enter this manually</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Geoserver-6-publish-layer-settings.png" alt="Geoserver 6 publish layer settings">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Type CRS manually into the 'Declared SRS' field. For OSM data (as published by the TestDynamicLayers code) use EPSG:4326</p>
</li>
<li>
<p>Click 'Compute from data' to get the native bounding box</p>
</li>
<li>
<p>Copy and paste all these fields into the Lat/Lon bounding box (for some reason, 'Compute from native bounds' is not working)</p>
</li>
<li>
<p>Save the layer</p>
</li>
<li>
<p>Repeat this for as many layers as you want to publish</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Geoserver-7-four-layers-published.png" alt="Geoserver 7 four layers published">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_previewing_layers">Previewing layers</h3>
<div class="paragraph">
<p>Preview one of the published layers</p>
</div>
<div class="paragraph">
<p>Go to the layer preview page and select the layer and 'OpenLayers' or other option for preview.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Geoserver-8-single-layer-preview.png" alt="Geoserver 8 single layer preview">
</div>
</div>
<div class="paragraph">
<p>Preview multiple layers</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a layer group, by clicking on 'layer groups'</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Geoserver-9-layer-groups.png" alt="Geoserver 9 layer groups">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>and then click 'add new layer group'.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Geoserver-10-layer-group-settings.png" alt="Geoserver 10 layer group settings">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Enter the name, and copy the bounds from one of the layers you plan to add. The 'Generate Bounds' function does not seem to work.</p>
</li>
<li>
<p>Enter the CRS as the same as the one used in one of the layers you plan to add.</p>
</li>
<li>
<p>Then click 'Add Layer' and select a layer to add to the group. Repeat this for as many layers as you plan to add.</p>
</li>
<li>
<p>Save the group and then go to the Layer Preview and you will see the group as an option to preview.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Geoserver-11-layer-preview-list.png" alt="Geoserver 11 layer preview list">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Select 'OpenLayers' to preview in a dynamic map that can be zoomed in.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Geoserver-12-layer-group-preview.png" alt="Geoserver 12 layer group preview">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_controlling_layer_style">Controlling layer style</h3>
<div class="paragraph">
<p>If you want to change the styles of the layers, one option is to go back to the layers list, select a layer, click the display tab and edit the styling information. This will also affect the preview in openlayers.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Geoserver-13-layers-preview-with-styles.png" alt="Geoserver 13 layers preview with styles">
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-05-30 14:25:15 -0400
</div>
</div>
</body>
</html>